
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Workshop Cypress</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="cypress-workshop-bdx"
                  title="Workshop Cypress"
                  environment="web"
                  feedback-link="TODO">
    
      <google-codelab-step label="Bienvenue ü§ó" duration="10">
        <p>Bienvenue dans ce workshop d√©di√© √† Cypress! Nous esp√©rons qu&#39;il vous plaira!</p>
<h2 is-upgraded>Ce que vous allez apprendre</h2>
<ul>
<li>Les bases de Cypress</li>
<li>Les diff√©rents niveaux de tests</li>
<li>Manipuler les requ√™tes XHR</li>
<li>Faire une commande personnalis√©e</li>
<li>Et d&#39;autres choses si nous avons le temps!</li>
</ul>
<h2 is-upgraded>Pendant le workshop</h2>
<p>N&#39;h√©sitez pas √†:</p>
<ul>
<li>√† soliciter les animateurs du workshop</li>
<li>aider les autres si vous avez d√©j√† de l&#39;exp√©rience avec Cypress</li>
<li>regarder la <a href="https://docs.cypress.io/api/api/table-of-contents.html" target="_blank">documentation (tr√®s bien faite) de Cypress</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Avant de commencer ‚úã" duration="15">
        <h2 is-upgraded>Pr√©-requis</h2>
<ul>
<li>Avoir une connection internet</li>
<li><a href="https://git-scm.com/downloads" target="_blank">Git</a></li>
<li><a href="https://nodejs.org/en/download/" target="_blank">NodeJs</a></li>
<li><em>Recommand√© mais pas obligatoire</em>: <a href="https://code.visualstudio.com/" target="_blank">Visual Studio Code</a></li>
</ul>
<aside class="warning"><p>Si par hasard, vous acc√©dez √† internet via un proxy d&#39;entreprise, pensez √† jeter aussi un coup d&#39;oeil sur <a href="https://docs.cypress.io/guides/references/proxy-configuration.html" target="_blank">cette page</a> pour que Cypress fonctionne correctement</p>
</aside>
<h2 is-upgraded>T√©l√©charger le repo</h2>
<pre><code>git clone  https://github.com/rbung/CypressWorkshop.git
</code></pre>
<h2 is-upgraded>Installer le projet</h2>
<pre><code>cd CypressWorkshop
npm install
</code></pre>
<h2 is-upgraded>V√©rifier que le tout fonctionne</h2>
<ul>
<li>Dans un terminal, lancer l&#39;application</li>
</ul>
<pre><code>npm start
</code></pre>
<ul>
<li>Dans un autre terminal, lancer Cypress</li>
</ul>
<pre><code>npx cypress open
</code></pre>
<ul>
<li>L&#39;interface suivante devrait s&#39;afficher</li>
</ul>
<p class="image-container"><img alt="interface accueil cypress" src="img/28c660fafaaefb4a.png"></p>
<ul>
<li>Lancer un test simple: cliquer sur le test <code>hello.spec.js</code></li>
</ul>
<p class="image-container"><img alt="premier test" src="img/ba4a8b3acc69819b.gif"></p>
<p>Vous √™tes maintenant pr√™t! üí™</p>


      </google-codelab-step>
    
      <google-codelab-step label="Critical Flow" duration="15">
        <p>Dans ce test, nous allons tester les principales fonctionnalit√©s propos√©es par le site. L&#39;objectif est de balayer l&#39;ensemble des pages et de v√©rifier qu&#39;elles sont correctement affich√©es. Nous allons aussi valider que les comportements de base fonctionnent correctement.</p>
<ul>
<li>Dans le fichier <code>spec.js</code>, compl√©ter the TODOs.</li>
</ul>
<aside class="warning"><p>La solution de l&#39;exercice se trouve dans le fichier <code>answer.js</code></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Hooks et factorisation" duration="15">
        <p>Dans ce test, nous allons tester la fonctionnalit√© d&#39;authentification de mani√®re exhaustive.</p>
<ul>
<li>Dans le fichier <code>spec.js</code>, compl√©ter the TODOs.</li>
<li>Vous verrez qu&#39;il y a des duplications dans le code au niveau de la commande <code>visit</code>. Pour y rem√©dier, pensez que vous √™tes dans un environnement <code>Mocha</code> : vous avez donc √† votre disposition les <a href="https://mochajs.org/#hooks" target="_blank">hooks</a></li>
<li>Autre duplication visible =&gt; La validation de la pr√©sence du message d&#39;erreur. Vous pouvez √©crire une fonction pour factoriser cette partie (<code>C&#39;est juste du JavaScript</code> üòâ)</li>
</ul>
<aside class="warning"><p>La solution de l&#39;exercice se trouve dans le fichier <code>answer.js</code></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Intercepter les requ√™tes XHR ü§Ø" duration="15">
        <p>Dans la premi√®re partie du test (celle concernant la partie non authentifi√©), on peut constater que les assertions sont tr√®s fines.<br>Lorsqu&#39;on lance le test, celui-ci √©choue, n√©anmoins : l&#39;article n&#39;existe pas c√¥t√© serveur (il a pu √™tre modifi√© ou autre).</p>
<p>Pour s&#39;afficher, la page <code>article</code> lance 2 requ√™tes vers le serveur : une pour r√©cup√©rer les informations relatives √† l&#39;article et une<br>autre pour r√©cup√©rer les commentaires li√©s √† cet article.</p>
<p>Nous allons utiliser les commandes <a href="https://docs.cypress.io/api/commands/server.html" target="_blank">cy.server</a> et <a href="https://docs.cypress.io/api/commands/route.html" target="_blank">cy.route</a> pour contr√¥ler les appels r√©seaux qui nous int√©ressent !</p>
<p>Une fois le premier test pass√©. Nous allons utilis√© la commande <code>cy.route</code> dans les autres tests pour simuler des erreurs (404, 500) ou avoir des temps de r√©ponses diff√©rents et ainsi pouvoir facilement voir comment r√©agit notre site sur des cas limites.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Les custom commands" duration="15">
        <p>Dans la deuxi√®me partie du test, nous devons √™tre authentifi√©. La fonctionnalit√© de <code>login</code> est importante dans notre site. Elle peut √™tre aussi utilis√©e pour afficher la page de <code>settings</code> par exemple. Pour mutualiser du code √† travers les diff√©rents tests, nous allons d√©velopper une <a href="https://docs.cypress.io/api/cypress-api/custom-commands.html" target="_blank">custom command</a> qui nous permettra de nous authentifi√© facilement dans nos tests.</p>
<p>Si reprendre le code que l&#39;on a vu lors dans notre test de la page <code>login</code> peut √™tre tentant, ce n&#39;est cependant pas la m√©thode la plus efficace. Plut√¥t que d&#39;utiliser l&#39;interface pour s&#39;authentifier, nous allons le faire de mani√®re programmatique ! üë®‚Äçüíª</p>
<p>Dans le fichier <code>commands.js</code> qui se trouve dans le r√©pertoire <code>support</code>, la commande <code>login</code> est d√©j√† d√©clar√©e pour vous. Utiliser la commande <a href="https://docs.cypress.io/api/commands/request.html" target="_blank">cy.request</a> pour faire une requ√™te <code>POST</code> sur le endpoint d&#39;authentification <code>https://docs.cypress.io/api/commands/request.html</code> puis utiliser la r√©ponse pour r√©cup√©rer le token et le positionner dans le local storage pour √™tre authentifi√© d&#39;un point de vue applicatif !</p>
<pre><code>window.localStorage.setItem(&#39;jwt&#39;, token)
</code></pre>
<aside class="special"><p>Pour que votre <code>custom command</code> soit au top üëå :<br> - contr√¥ler la mani√®re dont elle loggue dans le panel de commande <a href="https://docs.cypress.io/api/cypress-api/custom-commands.html#Command-Logging" target="_blank">https://docs.cypress.io/api/cypress-api/custom-commands.html#Command-Logging</a><br> - faites un fichier de d√©finition Typescript pour avoir la compl√©tion de votre command <a href="https://docs.cypress.io/api/cypress-api/custom-commands.html#5-Write-TypeScript-definitions" target="_blank">https://docs.cypress.io/api/cypress-api/custom-commands.html#5-Write-TypeScript-definitions</a></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Bonus üéÅ" duration="0">
        <p>Vous √™tes arriv√©s jusque l√† dans le temps imparti, bravo! üéâ</p>
<p>Si vous avez encore du temps, nous pouvons voir les sujets suivants :</p>
<ol type="1">
<li>La CICD</li>
<li>Test unitaire de composant</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Bonus - CICD" duration="0">
        <p>Utiliser Cypress en local avec une interface graphique, c&#39;est bien. Utiliser nos tests dans le cadre d&#39;une int√©gration continue, c&#39;est mieux ! Nous allons d√©couvrir comment ex√©cuter nos tests en mode <em>headless</em>, utiliser le <em>dashboard service</em> de Cypress et une int√©gration continue sur le cloud : <em>CircleCI</em>.</p>
<h2 is-upgraded>Le mode headless</h2>
<p>La commande <a href="https://docs.cypress.io/guides/guides/command-line.html#cypress-run" target="_blank">run</a> de Cypress permet de lancer nos tests en mode <em>headless</em> (c&#39;est-√†-dire, sans avoir besoin d&#39;interface graphique).</p>
<p>Dans le fichier <code>package.json</code>, d√©finissez un script <code>cypress:run</code> qui va ex√©cuter en mode <em>headless</em> tous les tests contenu dans le dossier <code>cypress/integration/devoxx</code>.</p>
<pre><code>&#34;cypress:run&#34;: &#34;cypress run -s &#39;cypress/integration/devoxx/**&#39;&#34;
</code></pre>
<pre><code>npm run cypress:run
</code></pre>
<h2 is-upgraded>Enregistrer vos ex√©cutions de tests</h2>
<aside class="warning"><p>Pr√©-requis : avoir un compte Github</p>
</aside>
<p>Avec l&#39;option <a href="https://docs.cypress.io/guides/guides/command-line.html#cypress-run-record-key-lt-record-key-gt" target="_blank">record</a>, nous allons pouvoir enregistrer diff√©rentes ex√©cutions :</p>
<ul>
<li>Lancer l&#39;interface de Cypress</li>
<li>S&#39;authentifier en cliquant sur le bouton <code>Log In</code> en haut √† droite</li>
<li>Une fois authentifi√©, vous pouvez maintenant aller sur la partie <code>Runs</code> de l&#39;interface, ensuite cliquer sur le bouton <code>Set up project to record</code></li>
<li>D√©finissez un nom ainsi que l&#39;organisation, puis valider (laissez votre projet en public)</li>
</ul>
<p>Un <code>projectId</code> sera d√©fini et sera automatiquement ajout√© √† votre fichier de configuration Cypress <code>cypress.json</code> üëå. Pensez √† commit√© ce fichier.</p>
<p>Une ligne de commande <code>cypress run</code> sera affich√© avec le param√®tre <code>key</code> positionn√©. Prenez cette ligne de commande et ex√©cutez-la dans votre terminal : votre test est en train d&#39;√™tre enregistr√© !</p>
<ul>
<li>Avec un navigateur, allez sur le <a href="https://dashboard.cypress.io/#/login" target="_blank">dashboard service</a> et validez que vos tests sont bien pr√©sents</li>
<li>Prenez le temps de d√©couvrir le <em>dashboard</em></li>
</ul>
<h2 is-upgraded>CICD sur le cloud</h2>
<p>Dans cette partie, nous allons utiliser <a href="https://circleci.com/" target="_blank">CircleCI</a>. Cypress peut √©videmment s&#39;interfacer avec de nombreuses solutions de CI (voir les <a href="https://docs.cypress.io/guides/guides/continuous-integration.html#Examples" target="_blank">exemples</a>). Cependant, la t√¢che est plus facile avec CircleCI gr√¢ce √† l&#39;<a href="https://github.com/cypress-io/circleci-orb" target="_blank">orbe Cypress</a> !</p>
<ol type="1">
<li>Cr√©ez un compte sur CircleCI</li>
<li>Pushez le code du projet sur un <em>repository</em> de votre compte Github</li>
<li>Dans CircleCI, d√©clarez votre projet fraichement cr√©√© (dans la partie <code>Add projects</code>)</li>
<li>Pensez √† positionner la variable d&#39;environnement <code>CYPRESS_RECORD_KEY</code> avec la cl√© qui a √©t√© g√©n√©r√© en 1√®re partie</li>
<li>Lancer un <em>build</em> (via CircleCI ou en poussant du code votre <em>repository</em>)</li>
<li>Une fois le <em>build</em> achev√©, allez dans le <a href="https://dashboard.cypress.io" target="_blank">dashboard service</a> et regardez les diff√©rents r√©sultats des tests ainsi que leur temps d&#39;ex√©cution.</li>
</ol>
<p>Comment √ßa marche ?</p>
<ul>
<li>Jetez un coup d&#39;oeil au fichier <code>circle.yml</code></li>
<li>La <a href="https://docs.cypress.io/guides/guides/continuous-integration.html#Example-CircleCI-Orb" target="_blank">documentation Cypress</a> relative √† la CICD avec CircleCI</li>
<li>La <a href="https://github.com/cypress-io/circleci-orb" target="_blank">doxumentation de l&#39;orbe Cypress</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Bonus - Test de composant" duration="0">
        <p>Dans ce test, nous allons tester un composant de mani√®re isol√©, en faisant le focus sur la banni√®re pr√©sente lorsqu&#39;il n&#39;y a pas d&#39;utilisateur connect√©.</p>
<p>L&#39;application √©tant en React, nous allons utiliser le plugin <a href="https://github.com/bahmutov/cypress-react-unit-test" target="_blank">cypress-react-unit-test</a></p>
<ul>
<li>Dans le fichier <code>spec.js</code>, compl√©ter the TODOs.</li>
</ul>
<p>‚ö†Ô∏è La solution de l&#39;exercice se trouve dans le fichier <code>answer.js</code> ‚ö†Ô∏è</p>


      </google-codelab-step>
    
      <google-codelab-step label="Merci üôè" duration="5">
        <p>Nous esp√©rons que vous avez appr√©ci√© ce workshop et que vous allez tr√®s vite utiliser Cypress!</p>
<h2 is-upgraded>Feedback</h2>
<p class="image-container"><img alt="feedback bdxio" src="img/eef18a330affae10.png"></p>
<p><a href="https://openfeedback.io/3BQH3sLpx0EfLHHC7Wng/2019-11-15/33" target="_blank">https://openfeedback.io/3BQH3sLpx0EfLHHC7Wng/2019-11-15/33</a></p>
<h2 is-upgraded>Gagnez un tshirt Cypress</h2>
<p>Remplissez le questionnaire: <a href="https://link.cypress.io/rodolphe-f" target="_blank">https://link.cypress.io/rodolphe-f</a></p>
<h2 is-upgraded>Nous contacter</h2>
<p>Sur Twitter</p>
<ul>
<li><a href="https://twitter.com/JkNourry" target="_blank">@JkNourry</a></li>
<li><a href="https://twitter.com/rodbung" target="_blank">@rodbung</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
